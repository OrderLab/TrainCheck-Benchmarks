Adapted from traincheck-input-programs/accelerate/complete_nlp_example